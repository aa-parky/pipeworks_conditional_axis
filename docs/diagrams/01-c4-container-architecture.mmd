C4Container
    title Pipeworks Ecosystem - Container Architecture

    Person(player, "Player", "User who experiences the world through The Daily Undertaking")

    System_Boundary(pipeworks, "Pipeworks Ecosystem") {
        ContainerDb(registry, "pipeworks-artefact", "Canonical Registry", "Defines what exists, what is missing, and what may be remembered. Provides stable identity and continuity. STATELESS: Immutable history.")

        Container(generator, "pipeworks_entity_state_generation", "Python/Generation Engine", "Produces resolved entity state snapshots. PURE: Deterministic, stateless transformation with axes, weights, and exclusions.")

        Container(mud_server, "pipeworks_mud_server", "Interactive Runtime", "Operates the living world, manages sessions, responds to player actions. STATEFUL: Adaptive, evolving world state.")

        Container(image_gen, "pipeworks_image_generator", "Visualisation Service", "Generates images from entity state. Translates conditions into visual representations. STATELESS: Deterministic rendering.")

        Container(ui, "the_daily_undertaking_ui", "Web Application / Narrative Singularity", "The ONLY component allowed to gossip across layers. Presents the world to the player. STATEFUL: Player session and narrative context.")
    }

    %% Data Pipeline Flow (Unidirectional Generation)
    Rel(registry, generator, "Provides", "Artefact ID + kind + metadata")
    Rel(generator, mud_server, "Produces", "Entity state snapshot (conditions, quirks, metadata)")

    %% MUD Server Interactions
    Rel(mud_server, image_gen, "Requests visualization", "Entity state + situational context")
    BiRel(mud_server, ui, "Bidirectional sync", "Player actions / Game state + narrative + entity info")

    %% Image Flow
    Rel(image_gen, ui, "Delivers", "Image URL/bytes + generation metadata")

    %% Player Interaction (The Singularity)
    BiRel(player, ui, "Interacts", "Player commands / World experience + narrative + visuals")

    UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="1")
