sequenceDiagram
    %% ============================================================
    %% CHARACTER LIFECYCLE: Appears and Is Shown to Player
    %% Demonstrates the complete Pipeworks pipeline in action
    %% ============================================================

    participant Player
    participant UI as The Daily<br/>Undertaking UI<br/>(Singularity)
    participant MUD as MUD Server<br/>(Runtime)
    participant ImgGen as Image<br/>Generator
    participant Gen as Entity State<br/>Generator<br/>(Pure)
    participant Reg as Artefact<br/>Registry

    %% ============================================================
    %% PHASE 1: Registration (Identity establishment)
    %% ============================================================

    Note over Reg: PHASE 1: REGISTRATION<br/>(Identity Layer)

    Reg->>Reg: Register artefact<br/>"artf_goblin_merchant"
    Note right of Reg: ✓ Stable ID created<br/>✓ Kind: character<br/>✓ Timestamp recorded<br/>✓ Status: exists

    %% ============================================================
    %% PHASE 2: State Generation (Pure transformation)
    %% ============================================================

    Note over Gen,Reg: PHASE 2: STATE GENERATION<br/>(Pure Zone)

    MUD->>Reg: Request artefact<br/>"artf_goblin_merchant"
    activate Reg
    Reg-->>MUD: Return artefact metadata<br/>{id, kind, timestamp}
    deactivate Reg

    MUD->>Gen: Generate entity state<br/>(artefact_id, seed, config)
    activate Gen
    Note right of Gen: Pure transformation:<br/>1. Apply character axes<br/>2. Weight selection<br/>3. Exclusion rules<br/>4. Generate conditions

    Gen->>Gen: Execute generation<br/>- physique: "wiry"<br/>- wealth: "modest"<br/>- demeanor: "suspicious"<br/>- age: "weathered"

    Gen-->>MUD: Entity state snapshot<br/>{conditions, quirks,<br/>generation_metadata}
    deactivate Gen

    %% ============================================================
    %% PHASE 3: World Integration (Stateful runtime)
    %% ============================================================

    Note over MUD: PHASE 3: WORLD INTEGRATION<br/>(Stateful Zone)

    MUD->>MUD: Place entity in world<br/>- Location: market square<br/>- Role: merchant<br/>- Inventory: generated<br/>- Behavior context: set

    Note right of MUD: ✓ Entity now exists in<br/>living world state<br/>✓ Interactive<br/>✓ Contextual

    %% ============================================================
    %% PHASE 4: Visualization (On-demand rendering)
    %% ============================================================

    Note over ImgGen,MUD: PHASE 4: VISUALIZATION

    MUD->>ImgGen: Request image<br/>(entity_state + context:<br/>"standing in market")
    activate ImgGen

    Note right of ImgGen: Pure rendering:<br/>1. Interpret conditions<br/>2. Build prompt<br/>3. Generate image<br/>4. Return metadata

    ImgGen->>ImgGen: Generate image<br/>from entity state

    ImgGen-->>MUD: Image asset<br/>{url, metadata,<br/>generation_params}
    deactivate ImgGen

    %% ============================================================
    %% PHASE 5: Player Presentation (Narrative singularity)
    %% ============================================================

    Note over UI,MUD: PHASE 5: PLAYER PRESENTATION<br/>(The Singularity)

    MUD->>UI: Send world state update<br/>{narrative, entity_info,<br/>image_ref}
    activate UI

    UI->>UI: Compose player experience<br/>- Narrative text<br/>- Entity description<br/>- Image display<br/>- Interaction options

    UI-->>Player: Present experience:<br/>"A wiry, weathered goblin<br/>eyes you suspiciously<br/>from behind a modest<br/>merchant's stall"<br/>[Show image]<br/>[Interaction options]
    deactivate UI

    %% ============================================================
    %% PHASE 6: Player Interaction (The loop continues)
    %% ============================================================

    Note over Player,UI: PHASE 6: INTERACTION

    Player->>UI: Action: "Talk to merchant"
    activate UI
    UI->>MUD: Player command<br/>{action: "talk",<br/>target: "artf_goblin_merchant"}
    deactivate UI

    activate MUD
    Note right of MUD: Process action using:<br/>✓ Entity state influence<br/>✓ World context<br/>✓ Game logic<br/>✓ Narrative generation

    MUD->>MUD: Execute game logic<br/>- Check entity demeanor<br/>- Generate dialogue<br/>- Update world state

    MUD->>UI: Narrative response<br/>"The goblin narrows its<br/>eyes. 'Coin first,<br/>then questions.'"
    deactivate MUD

    activate UI
    UI-->>Player: Display response<br/>[Continue interaction]
    deactivate UI

    %% ============================================================
    %% ANNOTATIONS
    %% ============================================================

    Note over Reg,Gen: <b>PURE ZONE</b><br/>Deterministic, Reproducible

    Note over MUD,UI: <b>STATEFUL ZONE</b><br/>Adaptive, Evolving, Interactive

    Note over UI: <b>SINGULARITY</b><br/>Everything converges here
